<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="/public/style.css" >
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">


    <title>Sign up</title>
  </head>
  <body  >
    <div class="col-sm-12">
        <div class=" logoheading text-center mt-5">
            <h2>Soleluxury</h2>
         </div>
         <div class=" subheading text-center ">
            <h4> Elevate your every step with opulence</h4>
         </div>

<div class="d-flex justify-content-center mt-5 pb-5"  >
  <div class="cards">
    <div class="card-body">
      <div style="text-align: center;">
        <h2 class="card-title">Sign up</h2>
       </div>

      <form id="logform" class="form-signup" method="post" action="/signup" >
        <div style="text-align: center;">
            <h6 class="sentenceofin">For Amazing Shopping</h6>
         </div>
          <div class="text-center" >
            <p id="messageDisplay"></p>
             </div>
                        <% if (locals.message) { %>
                            <span class="text-center w-50 mx-auto" style=" display: block;  color: red;" id="insertmessage"><%=message  %></span>
                         
                        <% } %>
           <div class="form-group">
          <div class="row mt-2  ">
            <div class="form-group mt-2">
              <input
                type="text"
                name="name"
                placeholder="full name"
                class="form-control"
                id="typeNamex"
                required
              />
            </div>
          </div>
        </div>
        <p><span id="error1" style="display: none; color: red;" ></span></p>
      
        <div class="form-group mt-2 row">
            <div class="col-md-8">
              <input
                type="email"
                name="email"
                placeholder="Enter your email"
                class="form-control w-70"
                id="typeEmailX"
                required
              />
            </div>
            <div class="col-md-4">
              <button type="button" class="btn otp"   id="sendOtp">Send OTP</button>
            </div>
          </div>
        
          
       
        <p><span id="error2" style="display: none;color: red; "></span></p>

        <div class="form-group mt-2 row ">
            <div class="col-6">
              <input
                type="number"
                name="otp"
                placeholder="Enter OTP"
                class="form-control "
                id="otpverify"
                required
              />
            </div>

            <div class="col-6">
              <button type="button" class="btn btn-primary" id="verify">Verify</button>
              <span id="timerDisplay" class="ms-2"></span>
            </div> 
          </div>
     
         
          

            
      
          
        
        <div class="form-group mt-3">
          <input
            type="number"
            name="mobile"
            placeholder="   Mobile number"
            class="form-control"
            id="typeMobileX"
            required
          />
        </div>
        <p><span id="error3" style="color: red;"></span></p>
      
        <div class="form-group mt-2">
          <input
            type="password"
            name="password"
            placeholder="  Password"
            class="form-control"
            id="typePasswordX"
            required
          />
        </div>
        
        <p><span id="error4" style="display: none;color: red;"></span></p>
        <div class="form-group mt-2">
            <input
              type="password"
              name="confirmPassword"
              placeholder=" Confirm Password"
              class="form-control"
          
              required
            />
          </div>
          <div class="form-group mt-2">
            
            <div>
                <input
                    type="code"
                    name="referralcode"
                    placeholder="Enter the Referral code"
                    class="form-control"
                    id="referalcodeX"
                    required
                />
            </div>
            <div >
              <p style="color: blue; font-size: small;" id="refferalCodeWarning">if you have any Referral*When Entering the referral code,check whether it is correct or not.</p>
          </div>
        </div>
        

        <div class="form-group mt-4">
          <input
            type="submit"
            class="form-control btn btn-primary btn-block btn-lg"
            value="Sign Up"
          
          />
        </div>
        
      </form>
      <div class="d-flex justify-content-center mt-2">
        <p>Already have an account? <a href="/" class="text-dark-50 fw-bold" style="text-decoration: none; color: black;">Login</a></p>
    </div>
    
    </div>
  </div>
</div>
</div>
<script src="/public/js/userSignUp.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script>

let  intervalId
 const verifybutton = document.getElementById("verify")
 verifybutton.style.display="none"
$(document).ready(function() {
  $('#sendOtp').click(function(e) {
    e.preventDefault();
    

    const emailInput = document.getElementById("typeEmailX");
    const email = emailInput.value;

    if (validateEmail(email)) {
      
      $.ajax({
        url: `/sendotp`,
        type: 'POST',
        data: JSON.stringify({ email: email }),
        contentType: 'application/json',
        success: function(response) {
          verifybutton.innerHTML="verify"
          verifybutton.style.display="inline"
          startTimer();
          const messageDisplay = document.getElementById("messageDisplay");
          messageDisplay.innerHTML = response.message;
          messageDisplay.style.color = 'green';
          setTimeout(function() {
            messageDisplay.innerHTML = '';
          }, 6000);
          document.querySelector(".otp").disabled=true;
          // Output: "OTP Send To Your Email"
        },
        error: function(error) {
          console.error('Error sending OTP:', error.responseJSON.error);
        }
      });
    } else {
      console.error('Invalid email');
    }
  });
});

function validateEmail(email) {
  const emailPattern = /^([a-zA-Z0-9._-]+)@([a-zA-Z.-]+).([a-zA-z]{2,4})$/;
  return emailPattern.test(email);
}

$(document).ready(function() {
  $('#verify').click(function() {
    const otpverify = document.getElementById("otpverify");
    const otpnumber = otpverify.value;

    $.ajax({
      url: "/verify",
      type: "POST",
      data: JSON.stringify({ otp: otpnumber }),
      contentType: "application/json",
      success: function(response) {
        
        const verifyButton = document.getElementById("verify");
        if (response.status) {
          Toastify({
                        text: "otp verified",
                        backgroundColor: "green",
                        duration: 4000,
                        position: "center" 
                    }).showToast();
          verifyButton.innerHTML = "Verified";
          clearInterval(intervalId);
          document.getElementById('timerDisplay').style.display = 'none';
          document.querySelector(".otp").disabled = false;
        } else {
          Toastify({
                        text: "otp verification failed",
                        backgroundColor: "red",
                        duration: 4000,
                        position: "center" 
                    }).showToast();
          verifyButton.innerHTML = "Failed";
          clearInterval(intervalId);
          resetTimer();
        }
      },
      error: function(error) {
        console.error('Error verifying OTP:', error.responseJSON.error);
      }
    });
  });
});

function startTimer() {
  let timer = 30;
  const timerDisplay = document.getElementById('timerDisplay');

  intervalId = setInterval(function() {
    timerDisplay.textContent = timer + " Sec Left";
    timer--;

    if (timer < 0) {
      clearInterval(intervalId);
      resetTimer();
      document.querySelector(".otp").disabled=true;
    }
  }, 1000);
}

function resetTimer() {
  const timerDisplay = document.getElementById('timerDisplay');
  document.querySelector(".otp").disabled= false;
  timerDisplay.textContent = '';
}

setTimeout(() => {
  const insertmessage = document.getElementById("insertmessage");
  insertmessage.style.display = 'none';
}, 6000);













</script>

  </body>
</html>

